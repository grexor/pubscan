<html>

<head>
    <title>pubScan: Explore your scientific co-authorship network</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">    
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link rel="stylesheet" href="pubscan.css?v=202505071">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.9/dist/autoComplete.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css">
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <meta name="description" content="pubScan lets you explore your scientific co-authorship network. Visualize collaborations across PubMed publications — fast, open-source, and mobile-friendly.">
    <meta name="keywords" content="pubScan, co-authorship network, PubMed, scientific collaboration, research visualization, academic graph, open science, papers network, science network, scientists network">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="pubScan: Explore your scientific co-authorship network">
    <meta property="og:description" content="Visualize your co-authorship network from PubMed data — fast, interactive, and open source.">
    <meta property="og:image" content="https://raw.githubusercontent.com/grexor/pubscan/main/web/pubscan_splash.jpg">
    <meta property="og:url" content="https://pubscan.expressrna.org">
    <meta name="twitter:card" content="summary_large_image">

    <script type="application/ld+json">
    {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "pubScan",
    "url": "https://pubscan.expressrna.org",
    "description": "Explore and visualize scientific co-authorship networks using PubMed data.",
    "applicationCategory": "Science",
    "operatingSystem": "All",
    "creator": {
        "@type": "Organization",
        "name": "pubScan Project"
    }
    }
    </script>    

</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-G0X1YQBFGS"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-G0X1YQBFGS');
</script>

<body>

    <div id="div_top" style="background-color:rgb(77, 131, 231); padding-left: 10px; padding-top: 10px; padding-bottom: 5px;">
        <div style="display: flex; width: 100%; flex-wrap: nowrap; align-items: center;">
            
            <div style="text-align: left; padding: 2px; flex-shrink: 0;">
                <a href="https://pubscan.expressrna.org">
                    <img src="pubscan_logo.jpg" style="height: 22px;">
                </a>
            </div>
            
            <div style="text-align: left; padding: 2px; padding-top: 2px; flex-shrink: 0;">
                <div style="color: aliceblue; font-size: 15px; padding-left: 3px;">
                    Explore co-authorships<div style="display:inline" id="div_update"></div>
                </div>
            </div>
            
            <div style="text-align: right; padding: 2px; padding-right: 15px; flex-grow: 1; overflow: hidden;" id="toptop_right_menu">
                <div style="color: aliceblue; font-size: 15px; padding-left: 3px; padding-bottom: 2px; white-space: nowrap;">
                    <span style="position: relative; top: 5px; display:inline-block; transform: scale(1.1);" id="btn_github_stars">
                    <a class="github-button" href="https://github.com/grexor/pubscan" data-icon="octicon-star" data-size="medium" data-show-count="true" aria-label="Star pubScan on GitHub">pubScan</a>
                    </span>
                    &nbsp;&nbsp;
                    <a id=btn_share href='javascript:url_to_clip();' class="links"><i class="fas fa-share-alt"></i>&nbsp;Share Network</a>
                </div>
            </div>

        </div>
    </div>

<div style="background-color:rgb(245, 245, 245); padding-left: 10px; padding-top: 5px; padding-bottom: 5px; color: #727272; z-index: 1000;  position: relative;">
    <div id="div_search_menu2" style="display: flex; width: 100%; flex-wrap: nowrap; z-index: 9999;">
        
        <div style="text-align: left; padding: 2px; z-index: 1000;">
            <div style="padding-left: 0px; z-index: 1000;">
                <input id="autoComplete" placeholder="Type author name..." />
            </div>
        </div>
        
        <div style="text-align: left; padding: 2px; padding-top: 9px; z-index: 1001;">
            <div id="btn_clear" class="hidden" style="padding-left: 5px; font-size: 14px; z-index: 1001; display: flex;">
                <a href='javascript:clear_search();'><i class="fas fa-times" style="color: #aaaaaa; margin-top: 3px; margin-left: -31px; z-index: 100; position: absolute"></i></a>
            </div>
        </div>

        <div style="text-align: left; padding: 2px; padding-top: 9px; flex-shrink: 0; white-space: nowrap;" id="div_search_label">
            <div id="div_info" style="padding-left: 0px; font-size: 12px;">
                Start your search
            </div>
        </div>
        
        <div id="mene_right_2" style="text-align: right; padding: 2px; padding-right: 15px; padding-top: 6px; flex-grow: 1; font-size: 14px; display: flex; justify-content: flex-end;">
            <input id="ac_search_nodes" placeholder="Find nodes..." style="flex-grow: 1;" />
            <div id="btn_clear_search_nodes" style="padding-left: 5px; font-size: 10px; display: inline-block; width: 0px;" class="hidden">
                <a href='javascript:clear_search_nodes();'><i class="fas fa-times" style="color: #aaaaaa; margin-top: 9px; margin-left: -20px; z-index: 100; position: absolute"></i></a>
            </div>
            &nbsp;&nbsp;
            <a id="btn_pub" class="links2" href="javascript:adjust_pub();"><i class="fas fa-pen-fancy" style="color: inherit !important;"></i>&nbsp;Publications</a>
            &nbsp;&nbsp;
            <a class="links2" href="javascript:globalThis.my_network.fit();"><i class="fas fa-align-center" style="color: inherit !important;"></i>&nbsp;Center</a>
            &nbsp;&nbsp;
            <a id="btn_log" class="links2" href="javascript:adjust_log();"><i class="fas fa-book" style="color: inherit !important;"></i>&nbsp;Log</a>
        </div>
    </div>
</div>

    <div id="mynetwork" tabindex="0"></div>

    <div id="div_bottom">
        <div style="display: flex; width: 100%;">
            <div style="text-align: left; padding: 2px;">
                Developed by <a href='https://grexor.github.io' target=_grexor>Gregor Rot</a>, Open Source at <a href='https://github.com/grexor/pubscan' target='_pubscan_github'>GitHub</a><br>
                <div style='font-size: 13px;'>You like this? Support by following me on <a href='https://x.com/gregor_rot' target=_x>Twitter/X</a>, <a href='https://bsky.app/profile/grexor.bsky.social' target=_bluesky>Bluesky</a></div>
            </div>
            <div style="text-align: right; padding: 2px; padding-right: 15px; flex-grow: 1; font-size: 12px; padding-top: 8px;">
                <table border="0" style='font-size: 13px; width: 750px; margin-left: auto; text-align: right; color: #aaaaaa;'>
                    <tr><td>
                        This site parses data from PubMed, latest update 2025. The authors of pubScan make no guarantees regarding the accuracy, completeness, or timeliness of the data and accept no liability for any errors, omissions, or outcomes resulting from its use.
                    </td></tr>
                </table>
            </div>
        </div>
    </div>

    <div id="div_bottom_mobile" style="display:none" onclick="swap_pub_mobile()">
        <div style="display: flex; width: 100%;">
            <div style="text-align: left; padding: 2px; padding-top: 10px;" id="div_bottom_mobile_label">
                Developed by <b><a href='https://grexor.github.io' target='_new'>Gregor Rot</a></b>, Open Source at <b><a href='https://github.com/grexor/pubscan' target='_new'>GitHub</a></b>
            </div>
        </div>
    </div>

    <script>

        function color_node_single(node_id, color) {
            nodes_dataset.update({ id: node_id, color: color });

        }

        let original_colors = {};

        function color_node_clear() {
            Object.entries(original_colors).forEach(([id, color_code]) => {
            const node = nodes_dataset.get(id);
            if (node && node.color) {
                delete node.color;
                nodes_dataset.update(node);
            }
            });
            original_colors = {}; // Clear the original_colors object
        }

        function color_node(search) {
            color_node_clear();
            new_color = "#00FF00";
            search = search.toLowerCase();
            const matching_nodes = nodes_dataset.get({
                filter: (node) => node.id.toString().toLowerCase().includes(search)
            });
            
            matching_nodes.forEach(node => {
                if (!original_colors[node.id]) {
                    if (node.color!="#00FF00") {
                        original_colors[node.id] = 1;
                    }
                }
                nodes_dataset.update({ id: node.id, color: new_color });
            });
        }

        function adjust_log() {
            if (isMobile())
                return;
            if (document.getElementById("btn_pub").classList.contains("active")) {
                adjust_pub();
            }
            const log_btn = document.getElementById("btn_log");
            log_btn.classList.toggle("active");

            document.getElementById("div_log").scrollTop = document.getElementById("div_log").scrollHeight;
            document.getElementById("div_log").classList.toggle("hidden");
        }

        function adjust_pub() {
            if (isMobile())
                return;
            if (document.getElementById("btn_log").classList.contains("active")) {
                adjust_log();
            }
            const pub_btn = document.getElementById("btn_pub");
            pub_btn.classList.toggle("active");

            document.getElementById("div_pub").scrollTop = 0;
            document.getElementById("div_pub").classList.toggle("hidden");
        }

        function clear_search() {
            document.querySelector("#autoComplete").value = "";
            document.getElementById("btn_clear").classList.add("hidden");
            document.querySelector("#autoComplete").focus();
        }

        function clear_search_nodes() {
            document.querySelector("#ac_search_nodes").value = "";
            document.getElementById("btn_clear_search_nodes").classList.add("hidden");
            document.querySelector("#ac_search_nodes").focus();
            color_node_clear();
        }

        function show_log() {
            if (isMobile())
                return;
            if (document.getElementById("btn_log").classList.contains("active")) {
                return;
            }
            // close all the rest
            if (!document.getElementById("btn_pub").classList.contains("active")) {
                adjust_pub();
            }
            adjust_log(); // open log
        }


        function show_splash() {
            if (isMobile())
                return;
            document.getElementById("div_splash").classList.remove("hidden");
        }

        function hide_splash() {
            document.getElementById("div_splash").classList.add("hidden");
        }

        function show_graph_info() {
            if (isMobile())
                return;
            document.getElementById("div_graph_info").classList.remove("hidden");
        }

        function hide_splash_info() {
            document.getElementById("div_graph_info").classList.add("hidden");
        }

        function show_center_info() {
            if (isMobile())
                return;
            document.getElementById("div_center_info").classList.remove("hidden");
        }

        function hide_center_info() {
            document.getElementById("div_center_info").classList.add("hidden");
        }

    </script>

    <script type="text/javascript">
      
    var my_network; 
    let current_center = "";
    let nodes_all = [];
    let nodes_dataset = [];
    let edges_all = [];
    let edges_dataset = [];
    let abortController = null;
    let signal = null;
    let clickTimeout = null;
    let handling_popstate = false;

    function draw() {
        var container = document.getElementById("mynetwork");

        if (globalThis.my_network) {
            globalThis.my_network.destroy();
            globalThis.my_network = null;
        }

        nodes_dataset = new vis.DataSet(nodes_all);
        edges_dataset = new vis.DataSet(edges_all);
        var data = {
          nodes: nodes_dataset,
          edges: edges_dataset,
        };
        var options = {
            autoResize: true,
            height: '100%',
            width: '100%',            
          groups : {
        'g0': { color: {background:'#EBF2F6', highlight: { background: '#EBF2F6'} } },
        'g1': { color: {background:'#C6D6E2', highlight: { background: '#C6D6E2'} } },
        'g2': { color: {background:'#93AEC5', highlight: { background: '#93AEC5'} } },
        'g3': { color: {background:'#293D4D', highlight: { background: '#293D4D'} } },
        'g4': { color: {background:'#CCEEFA', highlight: { background: '#C3EEFA'} } },
        'g5': { color: {background:'#FFEEFA', highlight: { background: '#C3EEFA'} } },
        'g6': { color: {background:'#B37676', highlight: { background: '#B37676'} } },
        'g7': { color: {background:'#C37676', highlight: { background: '#C37676'} } },
        'g8': { color: {background:'#D37676', highlight: { background: '#D37676'} } },
        },
        interaction: {
            zoomSpeed: 0.1,  // Slow down zooming (default is 1)
            navigationButtons: true,  // Optionally add navigation buttons (optional)
            keyboard: false
        },        
        nodes: {
            shape: "dot",
            size: 18,
                font: {
                    size: 35, // Adjust the font size here
                    color: '#454545',
                    face: 'arial',
                },            
          },
          edges: {
            color: '#ff0000',
            font: {
              size: 25,
              face: 'arial',
              color: '#a1a1a1',
            },
            //selectionWidth: 1,
          },
          layout: {
            improvedLayout: true,
            randomSeed: 42,
          },
          physics: {
            stabilization: {
                enabled: true,
                iterations: 200,
                updateInterval: 20,
                fit: true,
            },
            barnesHut: {
                gravitationalConstant: -4000, // Strength of attraction (-ve pulls nodes together)
                centralGravity: 0.3,         // Pull towards center
                springLength: 200,            // Edge length
                springConstant: 0.01,        // Strength of spring force
                damping: 0.1,               // Slow down movement over time
                avoidOverlap: 1              // Avoid node overlap (0 = disabled)
            },
            forceAtlas2Based: {
              gravitationalConstant: -20,
              centralGravity: 0.001,
              springConstant: 0.03, // how much attraction between nodes
              damping: 0.9,
              avoidOverlap: 1,
            },
            maxVelocity: 100,
            solver: "forceAtlas2Based",
            timestep: 0.3,
            adaptiveTimestep: true,
          },
        };

        let my_network = new vis.Network(container, data, options);

        globalThis.my_network = my_network;

        globalThis.my_network.on("doubleClick", function (params) {
            console.log("double click");
            if (clickTimeout) {
                clearTimeout(clickTimeout);
                clickTimeout = null;
                console.log("double click is clearing click timeout");
            }
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                onNodeDoubleClick(nodeId);
            }
        });

        globalThis.my_network.on("click", function (params) {
            if (clickTimeout) {
                return;
            }            
            clickTimeout = setTimeout(() => {
                clickTimeout = null;
                document.getElementById("div_pub").innerHTML = "Click on a node or edge to show publication information.";
                if (params.nodes.length > 0) { // node click
                    const node_id = params.nodes[0];
                    const node_data = nodes_dataset.get(node_id);
                    document.getElementById("div_pub").innerHTML = "Publications: <b>" + node_data["id"] + "</b> (" + node_data["pmids"].split(",").length + ")<br><br>";
                    document.getElementById("div_pub").scrollTop = 0;
                    document.getElementById("div_bottom_mobile_label").innerHTML = "Publications: <b>" + node_data["id"] + "</b> (" + node_data["pmids"].split(",").length + ")";
                    div_pub_text = document.getElementById("div_bottom_mobile_label").innerHTML;
                    get_publications(node_data["pmids"]);

                }
                else if (params.edges.length > 0) { // edge click
                    const edge_id = params.edges[0];
                    const edge_data = edges_dataset.get(edge_id);
                    document.getElementById("div_pub").scrollTop = 0;
                    document.getElementById("div_pub").innerHTML = "Publications co-authored between <b>" + edge_data["from"] + "</b> and <b>" + edge_data["to"] + "</b> (" + edge_data["pmids"].split(",").length + ")<br><br>";
                    document.getElementById("div_bottom_mobile_label").innerHTML = "Publications: <b>" + edge_data["from"] + "</b> and <b>" + edge_data["to"] + "</b> (" + edge_data["pmids"].split(",").length + ")";
                    div_pub_text = document.getElementById("div_bottom_mobile_label").innerHTML;
                    get_publications(edge_data["pmids"]);
                }
            }, 250);
        });

        // color the node red and show publications for the node
        color_node_single(current_center, 'red');
        const center_data = nodes_dataset.get(current_center);
        document.getElementById("div_pub").innerHTML = "Publications: <b>" + center_data["id"] + "</b> (" + center_data["pmids"].split(",").length + ")<br><br>";
        document.getElementById("div_bottom_mobile_label").innerHTML = "Publications: <b>" + center_data["id"] + "</b> (" + center_data["pmids"].split(",").length + ")";
        div_pub_text = document.getElementById("div_bottom_mobile_label").innerHTML;

        get_publications(center_data["pmids"]);

        // switch to network view on mobile (in case pub view was open)
        if (isMobile()) {
            document.getElementById("div_bottom_mobile_label").innerHTML = div_pub_text;
            $("#div_pub").hide();
            $("#mynetwork").show();
            mobile_view = "network";
        }

      }

        function get_update_date() {
            fetch("https://pubscan.expressrna.org/gw/index.py?action=get_update_date").then(response =>
            {
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = "";

                function readStream() {
                    return reader.read().then(({ done, value }) => {
                        if (done) {
                            return;
                        }
                        buffer += decoder.decode(value, { stream: true });
                        let parts = buffer.split("\n");  
                        buffer = parts.pop();  // Keep the last incomplete part in buffer
                        for (const part of parts) {
                            try {
                                console.log(part);
                                const update_str = part;
                                document.getElementById("div_update").innerHTML = "(Pubmed sync: " + update_str + ")";
                            } catch (error) {
                                console.error("Error getting update date:", error);
                            }
                        }
                        return readStream(); // Continue reading next chunks
                    });
                }
                return readStream();
            })
            .catch(error => console.error("Error:", error));
        }

        function get_publications(pmids) {
            let encodedQuery = encodeURIComponent(pmids);
            const datetime = new Date().toISOString();
            fetch("https://pubscan.expressrna.org/gw/index.py?action=get_publications&pmids=" + encodedQuery + "&response_type=json&datetime=" + datetime).then(response =>
            {
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = "";

                function readStream() {
                    return reader.read().then(({ done, value }) => {
                        if (done) {
                            // stream finished
                            return;
                        }
                        buffer += decoder.decode(value, { stream: true });
                        let parts = buffer.split("\n");  
                        buffer = parts.pop();  // Keep the last incomplete part in buffer
                        for (const part of parts) {
                            try {
                                const mydata = JSON.parse(part);
                                //const sorted_data = Object.values(mydata).sort((a, b) => b.pmid - a.pmid);
                                const sorted_data = Object.values(mydata).sort((a, b) => {
                                const yearA = parseInt(a.pub_year, 10);
                                const yearB = parseInt(b.pub_year, 10);

                                if (yearB !== yearA) {
                                    return yearB - yearA; // Sort by pub_year descending
                                }

                                return parseInt(b.pmid, 10) - parseInt(a.pmid, 10); // Then by pmid descending
                                });
                                html_add = "";
                                html_add += "<table border=10>"
                                for (const e of sorted_data) {
                                    html_add += "<tr><td>" + e.pub_year + "&nbsp;&nbsp;</td><td><a href=https://pubmed.ncbi.nlm.nih.gov/" + e.pmid + " target=_" + e.pmid + ">" + e.title + "</a></td></tr>";
                                }           
                                html_add += "</table>"
                                document.getElementById("div_pub").innerHTML += html_add;

                                if (!document.getElementById("btn_pub").classList.contains("active")) {
                                    adjust_pub();
                                }

                            } catch (error) {
                                console.error("Error parsing JSON:", error);
                            }
                        }
                        return readStream(); // Continue reading next chunks
                    });
                }
                return readStream();
            })
            .catch(error => console.error("Error:", error));
        }

        function url_to_clip() {
            navigator.clipboard.writeText(window.location.href).catch(err => alert("Failed to copy URL: " + err));
        }

        function get_author_network(query) {
            hide_splash();
            hide_center_info();
            ac_tooltip.hide();
            show_log();
            show_graph_info();
            document.getElementById("div_log").innerHTML = "Log of communication of pubScan with the server. Use to follow what's happening.<br><br>";
            let encodedQuery = encodeURIComponent(query);

            // already loaded? abort
            if (current_center==query.toLowerCase()) {
                return;
            }

            current_center = query.toLowerCase();
            const datetime = new Date().toISOString();

            try {
                if (abortController) {
                    abortController.abort();
                }
            } catch (error) {
            }

            abortController = new AbortController();
            signal = abortController.signal;

            fetch("https://pubscan.expressrna.org/gw/index.py?action=get_author_network&author=" + encodedQuery + "&response_type=json&datetime=" + datetime, { signal: signal }).then(response =>
            {
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = "";

                function readStream() {
                    return reader.read().then(({ done, value }) => {
                        if (done) {
                            // stream finished
                            return;
                        }

                        buffer += decoder.decode(value, { stream: true });

                        // Process each complete JSON object (assuming newline-delimited JSON)
                        let parts = buffer.split("\n");  
                        buffer = parts.pop();  // Keep the last incomplete part in buffer

                        for (const part of parts) {
                            try {
                                const mydata = JSON.parse(part);
                                if (mydata["instruction"]=="data") {
                                    if (mydata["nodes_all"].length==0) {
                                        document.getElementById("div_log").innerHTML += "search for <b>" + query + "</b> returned no results.";
                                        document.getElementById("div_center_info_content").innerHTML = "Search for <b>" + query + "</b> returned no results.";
                                        //document.getElementById("div_bottom_mobile_label").innerHTML = "Search for <b>" + query + "</b> returned no results.";
                                        document.getElementById("div_info").innerHTML = "Search for <b>" + query + "</b> returned no results.";
                                        if (nodes_all.length==[]) {
                                            show_center_info();
                                        }
                                        return;
                                    }
                                    nodes_all = mydata["nodes_all"];
                                    edges_all = mydata["edges_all"];
                                    draw();
                                    document.querySelector("#autoComplete").value = query;
                                    document.querySelector("#ac_search_nodes").value = "";
                                    update_clear_button();
                                    let encoded_coded_query = encodeURIComponent(query.replace(/ /g, "_"));
                                    if (!handling_popstate) {
                                        const new_url = `/${encoded_coded_query}`;
                                        window.history.pushState({"search": query}, '', new_url);
                                    }
                                    handling_popstate = false;
                                    document.getElementById("div_graph_title").innerHTML = "Browsing network for: <b>" + query + "</b>";
                                }
                                if (mydata["instruction"]=="progress") {
                                    document.getElementById("div_info").textContent = mydata["description"];
                                    document.getElementById("div_log").innerHTML += mydata["description"] + "<br>";
                                    document.getElementById("div_log").scrollTop = document.getElementById("div_log").scrollHeight;
                                }

                            } catch (error) {
                                console.error("Error parsing JSON:", error);
                            }
                        }

                        return readStream(); // Continue reading next chunks
                    });
                }
                
                return readStream();
            })
            .catch(error => console.error("Error:", error));

        }

    function onNodeDoubleClick(nodeId) {
        if (current_center==nodeId) {
            return;
        }
        get_author_network(nodeId);
    }        

    </script>

<script>

    let suppressSuggestions;
    let autocompleteAbortController;

    const autoCompleteJS = new autoComplete({
    selector: "#autoComplete",
    placeHolder: "Search for author...",
    data: {
        src: async (query) => {
            if (suppressSuggestions) {
                suppressSuggestions = false;
                return [];
            }

            if (autocompleteAbortController) {
                try {
                    autocompleteAbortController.abort();
                } catch (err) {
                    console.warn("Error aborting previous autocomplete request:", err);
                }
            }

            autocompleteAbortController = new AbortController();
            const autocomplete_signal = autocompleteAbortController.signal;

            try {
                const query_lower = encodeURIComponent(query.toLowerCase());
                const response = await fetch(
                    `https://pubscan.expressrna.org/gw/index.py?action=author_suggest&author_name=${query_lower}`,
                    { signal: autocomplete_signal }
                );
                return await response.json();
            } catch (err) {
                if (err.name === 'AbortError') {
                    return [];
                } else {
                    console.error("Fetch error:", err);
                    return [];
                }
            }
        },
        cache: false
    },
    threshold: 2,
    debounce: 100,
    searchEngine: (query, record) => {
        return record;
    },
    resultItem: {
        highlight: true
    },
    resultsList: {
        maxResults: 6
    },
    events: {
        input: {
            selection: (event) => {
                const selection = event.detail.selection.value;
                document.querySelector("#autoComplete").value = selection;
                $('#mynetwork').focus();
                get_author_network(selection);
                autoCompleteJS.close();
                $('#mynetwork').focus();
            }
        }
    }
    });

    const ac_search_nodes_js = new autoComplete({
    selector: "#ac_search_nodes",
    placeHolder: "Search nodes...",
    data: {
        src: () => [], // 🔒 Always return an empty array (no suggestions)
        cache: false
    },
    threshold: 2,
    debounce: 10,
    searchEngine: "strict", // Use default string search
    resultItem: {
        highlight: true
    },
    resultsList: {
        maxResults: 6
    },
    });

  </script>

  <script>

    function update_clear_button() {
        if (document.querySelector("#autoComplete").value != "") {
            document.getElementById("btn_clear").classList.remove("hidden");
        }        
    }

    function update_nodes_clear_button() {
        if (document.querySelector("#ac_search_nodes").value != "") {
            document.getElementById("btn_clear_search_nodes").classList.remove("hidden");
        } else {
            document.getElementById("btn_clear_search_nodes").classList.add("hidden");
            color_node_clear();
        }
    }

    document.querySelector("#autoComplete").addEventListener("keydown", function(e) {
        if (e.key === "Enter") {
            suppressSuggestions = true;
            autoCompleteJS.close();        
            const value = e.target.value;
            get_author_network(value);
            $('#mynetwork').focus();
            e.preventDefault();
        } else {
            suppressSuggestions = false;    
        }
        update_clear_button();
    });

    document.querySelector("#autoComplete").addEventListener("input", function(e) {
        update_clear_button();
    });

    document.querySelector("#autoComplete").addEventListener("focus", function(e) {
        suppressSuggestions = false;
        update_clear_button();
        ac_tooltip.hide();
    });

    document.querySelector("#ac_search_nodes").addEventListener("input", function(e) {
        update_nodes_clear_button();
        const value = e.target.value.toLowerCase();
        if (value.length>=3) {
            color_node(value);
        } else {
            color_node_clear();
        }       
    });


  </script>

<style>

    .tippy-box[data-theme='pubscan'] {
      background-color: #0f4b92;
      color: rgb(255, 255, 255);
    }

    .tippy-box[data-theme='pubscan'] .tippy-tooltip {
        background-color: #0f4b92;
        color: rgb(255, 255, 255);
    }

    .tippy-box[data-theme='pubscan'] .tippy-arrow {
        color: #0f4b92;
    }

    .tippy-box[data-theme='pubscan_start'] {
      background-color: #ff8b8b;
      color: rgb(255, 255, 255);
    }

    .tippy-box[data-theme='pubscan_start'] .tippy-tooltip {
        background-color: #ff8b8b;
        color: rgb(255, 255, 255);
    }

    .tippy-box[data-theme='pubscan_start'] .tippy-arrow {
        color: #ff8b8b;
    }

</style>

<script>

    tippy('#btn_share', {
        theme: 'pubscan',
        trigger: 'click',
        content: 'Copied to clipboard!',
        onShow(instance) {
            setTimeout(() => {
            instance.hide();
            }, 2000);
        }        
      });

      const [ac_tooltip] = tippy('#autoComplete', {
        theme: 'pubscan_start',
        trigger: 'click',
        placement: 'bottom',
        content: 'Start here by searching for a fellow scientist!',
        trigger: 'manual',
        interactive: true,
        hideOnClick: false,
      });

</script>

<script>

    function isMobile() {
    return /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    let mobile_view;
    let div_pub_text;

    window.onload = function () {

    tippy('#btn_share2', {
        theme: 'pubscan',
        trigger: 'click',
        content: 'Copied to clipboard!',
        onShow(instance) {
            setTimeout(() => {
            instance.hide();
            }, 2000);
        }        
      });

        if (!isMobile()) {
            ac_tooltip.show();
        }
            
        if (isMobile()) {

            mobile_view = "network";

            document.getElementById('mene_right_2').style.display = 'none';
            $("#div_bottom").hide();
            //$("#toptop_right_menu").hide();

            $("#div_update").hide();

            $("#div_search_menu2").css("flex-direction", "column");
            $("#div_search_menu2").css("border", "");
            $("#mene_right_2").hide();
            $("#btn_github_stars").hide();
            $("#div_graph_title").hide();
            $("#div_search_label").css("padding-top", "0px");
            $("#div_search_label").css("text-align", "center");
            $("#div_search_label").css("margin-top", "-5px");
            $("#div_search_label").css("border", "none");
            $("#div_info").css("z-index", "0");
            $("#div_info").html("Ready to start searching :-)");

            $("#div_search_menu2").css("z-index", 9999);
            $("#mynetwork").attr("style", "z-index: 1 !important;");

            const el = document.getElementById("div_bottom_mobile");
            el.style.display = "flex";
            el.style.position = "fixed";
            el.style.bottom = "0";
            el.style.left = "0";
            el.style.width = "100%";
            el.style.height = "50px";
            el.style.backgroundColor = "#408bed";
            el.style.color = "white";
            el.style.paddingLeft = "20px";
            el.style.borderTop = "1px dashed rgb(220,220,220)";
            el.style.zIndex = "9999";
            el.style.transform = "translateZ(0)";
            el.style.willChange = "transform";

            $("#mynetwork").css("border", "none");
            $("#mynetwork").css("top", "113px");

            $("#div_pub").attr("style", $("#mynetwork").attr("style"));
            const divPub = document.getElementById("div_pub");
            divPub.className = "div_pub_mobile";
            $("#div_pub").hide();

            const divSplash = document.getElementById("div_splash");
            divSplash.className = "splash_mobile_div";
            
        }

        get_update_date();

        const path = window.location.pathname;
        const centerRaw = path.split("/").filter(Boolean).pop();
        if (centerRaw) {
            const center = centerRaw.replace(/_/g, " ");
            get_author_network(center);

        }
    };

function swap_pub_mobile() {
    if (document.getElementById("div_bottom_mobile_label").innerHTML.indexOf("Developed by")>0)
        return;
    if (mobile_view=="network")
    {
        div_pub_text = document.getElementById("div_bottom_mobile_label").innerHTML;
        document.getElementById("div_bottom_mobile_label").innerHTML = "Back to network";
        $("#mynetwork").hide();
        $("#div_pub").removeClass("hidden").show();
        mobile_view = "pub";
        return;
    }
    if (mobile_view=="pub")
    {
        document.getElementById("div_bottom_mobile_label").innerHTML = div_pub_text;
        $("#div_pub").hide();
        $("#mynetwork").show();
        mobile_view = "network";
        return;
    }
}

</script>

<div id=div_log class="div_log hidden">
    Log of communication of pubScan with the server. Use to follow what's happening.
</div>

<div id=div_pub class="div_pub hidden">
    Here information on authors publications is provided when you click on a node (author) or on an edge between authors (joint publications).
</div>

<div id="div_splash" class="splash_div">
    <div style="max-width: 900px; width: 90%; text-align: left; margin: 0 auto; word-wrap: break-word;">
        <div style='font-size: 18px; padding-top: 10px; color: #a63f3b;'>
            Welcome to pubScan!
        </div>
        <div style='font-size: 16px; padding-top: 13px; color: #868686'>
            What is it?<br>
        </div>
        <div style='font-size: 15px; color: #9a9a9a'>
            pubScan is an interactive interface to explore all PubMed articles as a co-authorship network. In this network
            <b>nodes</b> represent authors, <b>edges</b> represent co-authored publications.
        </div>
        <div style='font-size: 16px; padding-top: 13px; color: #868686'>
            Who appears at the center of the network?<br>
        </div>
        <div style='font-size: 16px; color: #9a9a9a'>
            The author you search for in the input box (top-left) will appear at the center of the network, highlighted in red <div style="width:10px; height:10px; background:red; border-radius:50%; display:inline-block;"></div>.
            <br>Other nodes are colored based on the number of publications for the author in PubMed:
            <br><div style="width:10px; height:10px; background:#EBF2F6; border-radius:50%; display:inline-block;"></div> &lt; 10 publications,
            <div style="width:10px; height:10px; background:#C6D6E2; border-radius:50%; display:inline-block;"></div> 10-50 publications,
            <div style="width:10px; height:10px; background:#93AEC5; border-radius:50%; display:inline-block;"></div> 50-100 publications,
            <div style="width:10px; height:10px; background:#293D4D; border-radius:50%; display:inline-block;"></div> &gt; 100 publications
        </div>
        <div style='font-size: 16px; padding-top: 13px; color: #868686'>
            Are all co-authors shown?<br>
        </div>
        <div style='font-size: 15px; color: #9a9a9a'>
            To keep the network readable and responsive, pubScan displays:
            <ui><br>Up to 150 co-authors (ranked by number of shared publications)
            <ui><br>Up to 2,000 edges: this includes all edges between the central author and their co-authors, the 100 strongest co-authorship links, and a random sample of the remaining edges
        </div>
        <div style='font-size: 16px; padding-top: 13px; color: #868686'>
            Love it? Want to support the project?<br>
        </div>
        <div style='font-size: 15px; color: #9a9a9a'>
            Network and <a id="btn_share2" href='javascript:url_to_clip()'>share pubScan </a> with fellow scientists. Check the source code and * <a href='https://github.com/grexor/pubscan' target="_github">pubScan on Github</a>.
        </div>


    </div>
</div>

<div id="div_center_info" class="center_info_div hidden">
    <div style="width: 400px; text-align: center; margin: 0 auto; border: 0px dashed #eaeaea; border-radius: 5px; background-color: #ffffff; height: 20px;">
        <div id="div_center_info_content" style='font-size: 14px; padding-top: 0px; color: #666666;'>
            No results found.
        </div>
    </div>
</div>

<div id="div_graph_info" style="font-size: 13px; padding-top: 10px; padding-left: 10px; color: #777777;" class="hidden">

    Click node to show publications.<br>
    Click edge to show co-authored publications.<br>
    Double-click node to re-center network to clicked author.<br>

</div>

<div id="div_graph_title" style="width: 350px; height: 20px; position: absolute; top: 60px; left: 50%; transform: translateX(-50%); font-size: 13px; color: #804343;">
</div>

<script>

    // Listen to back/forward navigation
    window.addEventListener('popstate', function (event) {
    handling_popstate = true;
    get_author_network(event.state.search);
    });

</script>


    </body>
</html>
